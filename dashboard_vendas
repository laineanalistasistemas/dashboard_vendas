import streamlit as st
import pandas as pd
import plotly.express as px

# -------------------------------
# ğŸ“Š Dashboard de Vendas
# -------------------------------

def carregar_dados(caminho: str):
    """Carrega os dados de vendas a partir de um CSV."""
    return pd.read_csv(caminho)

def main():
    st.set_page_config(page_title="Dashboard de Vendas", layout="wide")
    st.title("ğŸ“Š Dashboard de Vendas")
    st.markdown("Transformando dados brutos em informaÃ§Ãµes visuais claras e Ãºteis.")

    # Upload de arquivo CSV
    arquivo = st.file_uploader("Carregue o arquivo de vendas (CSV)", type=["csv"])
    
    if arquivo is not None:
        df = carregar_dados(arquivo)

        # Exibe os dados brutos
        st.subheader("ğŸ“‚ Dados Brutos")
        st.dataframe(df)

        # SeleÃ§Ã£o de filtros
        st.sidebar.header("Filtros")
        produto = st.sidebar.selectbox("Selecione o Produto", options=["Todos"] + list(df["Produto"].unique()))
        regiao = st.sidebar.selectbox("Selecione a RegiÃ£o", options=["Todos"] + list(df["RegiÃ£o"].unique()))

        df_filtrado = df.copy()
        if produto != "Todos":
            df_filtrado = df_filtrado[df_filtrado["Produto"] == produto]
        if regiao != "Todos":
            df_filtrado = df_filtrado[df_filtrado["RegiÃ£o"] == regiao]

        # GrÃ¡fico de vendas por mÃªs
        st.subheader("ğŸ“ˆ Vendas por MÃªs")
        vendas_mes = df_filtrado.groupby("MÃªs")["Vendas"].sum().reset_index()
        fig = px.bar(vendas_mes, x="MÃªs", y="Vendas", title="Total de Vendas por MÃªs", text_auto=True)
        st.plotly_chart(fig, use_container_width=True)

        # GrÃ¡fico de vendas por regiÃ£o
        st.subheader("ğŸŒ Vendas por RegiÃ£o")
        vendas_regiao = df_filtrado.groupby("RegiÃ£o")["Vendas"].sum().reset_index()
        fig2 = px.pie(vendas_regiao, names="RegiÃ£o", values="Vendas", title="DistribuiÃ§Ã£o de Vendas por RegiÃ£o")
        st.plotly_chart(fig2, use_container_width=True)

        # GrÃ¡fico de vendas por produto
        st.subheader("ğŸ“¦ Vendas por Produto")
        vendas_produto = df_filtrado.groupby("Produto")["Vendas"].sum().reset_index()
        fig3 = px.bar(vendas_produto, x="Produto", y="Vendas", title="Total de Vendas por Produto", text_auto=True)
        st.plotly_chart(fig3, use_container_width=True)

    else:
        st.info("Por favor, carregue um arquivo CSV para visualizar o dashboard.")

if __name__ == "__main__":
    main()
